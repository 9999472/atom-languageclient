Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclientV = require('./protocol/languageclient-v2');

var ls = _interopRequireWildcard(_languageclientV);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _consoleLogger = require('./loggers/console-logger');

var _consoleLogger2 = _interopRequireDefault(_consoleLogger);

var _nullLogger = require('./loggers/null-logger');

var _nullLogger2 = _interopRequireDefault(_nullLogger);

var _autocompleteBridge = require('./bridges/autocomplete-bridge');

var _autocompleteBridge2 = _interopRequireDefault(_autocompleteBridge);

var _documentSyncBridge = require('./bridges/document-sync-bridge');

var _documentSyncBridge2 = _interopRequireDefault(_documentSyncBridge);

var _formatCodeBridge = require('./bridges/format-code-bridge');

var _formatCodeBridge2 = _interopRequireDefault(_formatCodeBridge);

var _linterBridge = require('./bridges/linter-bridge');

var _linterBridge2 = _interopRequireDefault(_linterBridge);

var _notificationsBridge = require('./bridges/notifications-bridge');

var _notificationsBridge2 = _interopRequireDefault(_notificationsBridge);

var _nuclideDefinitionBridge = require('./bridges/nuclide-definition-bridge');

var _nuclideDefinitionBridge2 = _interopRequireDefault(_nuclideDefinitionBridge);

var _nuclideFindReferencesBridge = require('./bridges/nuclide-find-references-bridge');

var _nuclideFindReferencesBridge2 = _interopRequireDefault(_nuclideFindReferencesBridge);

var _nuclideHyperclickBridge = require('./bridges/nuclide-hyperclick-bridge');

var _nuclideHyperclickBridge2 = _interopRequireDefault(_nuclideHyperclickBridge);

var _nuclideOutlineViewBridge = require('./bridges/nuclide-outline-view-bridge');

var _nuclideOutlineViewBridge2 = _interopRequireDefault(_nuclideOutlineViewBridge);

var _atom = require('atom');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

let AutoBridge = class AutoBridge {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
  }

  getName() {
    throw "Must set name field when extending AutoBridge";
  }
  getGrammarScopes() {
    throw "Must set grammarScopes field when extending AutoBridge";
  }

  activate() {
    this.logger = atom.config.get('core.debugLSP') ? new _consoleLogger2.default(this.getName()) : new _nullLogger2.default();
    this.startServer();
  }

  deactivate() {
    this._disposable.dispose();

    if (this._lc) {
      this._lc.shutdown();
    }

    if (this._process != null) {
      this._process.kill();
      this._process = null;
    };
  }

  startServer() {
    var _this = this;

    return _asyncToGenerator(function* () {
      if (_this._process != null) return;

      _this._process = yield _this.startServerProcess();

      const connection = rpc.createMessageConnection(new rpc.StreamMessageReader(_this._process.stdout), new rpc.StreamMessageWriter(_this._process.stdin), { error: function (m) {
          _this.logger.error(m);
        } });

      _this._lc = new ls.LanguageClientV2(connection, _this.logger);
      _this._lc.onLogMessage(function (m) {
        return _this.logger.log(['Log', m]);
      });

      const initializeResponse = yield _this._lc.initialize(_this.getInitializeParams());
      _this.bridgeCapabilities(initializeResponse.capabilities);
      _this.postInitialization(initializeResponse);
    })();
  }

  startServerProcess() {
    throw "Must override startServerProcess to start the language server process when extending AutoBridge";
  }

  getProjectRoot() {
    const rootDirs = atom.project.getDirectories();
    return rootDirs.length > 0 ? rootDirs[0].path : null;
  }

  getInitializeParams() {
    return {
      processId: process.pid,
      capabilities: {},
      rootPath: this.getProjectRoot()
    };
  }

  bridgeCapabilities(capabilities) {
    this.linter = new _linterBridge2.default(this._lc);
    if (capabilities.completionProvider) {
      this.autoComplete = new _autocompleteBridge2.default(this._lc);
    }
    if (capabilities.definitionProvider) {
      this.definitions = new _nuclideDefinitionBridge2.default(this._lc);
      this.hyperclick = new _nuclideHyperclickBridge2.default(this._lc);
    }
    if (capabilities.documentSymbolProvider) {
      this.outlineView = new _nuclideOutlineViewBridge2.default(this._lc, this.getName());
    }
    if (capabilities.referencesProvider) {
      this.findReferences = new _nuclideFindReferencesBridge2.default(this._lc);
    }

    new _notificationsBridge2.default(this._lc, this.getName());

    if (capabilities.textDocumentSync) {
      this._disposable.add(new _documentSyncBridge2.default(this._lc, capabilities.textDocumentSync));
    }
    if (capabilities.documentRangeFormattingProvider || capabilities.documentFormattingProvider) {
      this._disposable.add(new _formatCodeBridge2.default(this._lc, capabilities.documentRangeFormattingProvider === true, capabilities.documentFormattingProvider === true));
    }
  }

  postInitialization(InitializationResult) {}

  // Atom Autocomplete+ via LS completion

  provideAutocomplete() {
    return {
      selector: '.source',
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  getSuggestions(request) {
    return this.autoComplete != null ? this.autoComplete.getSuggestions(request) : Promise.resolve([]);
  }

  // Nuclide Definitions via LS documentHighlight and gotoDefinition

  provideDefinitions() {
    return {
      name: this.getName(),
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this),
      getDefinitionById: this.getDefinitionById.bind(this)
    };
  }

  getDefinition(editor, point) {
    return this.definitions != null ? this.definitions.getDefinition(editor, point) : Promise.resolve(null);
  }

  getDefinitionById(filename, id) {
    return Promise.resolve(null); // TODO: Is this needed?
  }

  // Nuclide Outline View via LS documentSymbol

  provideOutlines() {
    return {
      name: this.getName(),
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  getOutline(editor) {
    return this.outlineView != null ? this.outlineView.getOutline(editor) : Promise.resolve(null);
  }

  // Linter API via LS publishDiagnostics

  provideLinter() {
    return {
      name: this.getName(),
      grammarScopes: this.getGrammarScopes(),
      scope: 'project',
      lintOnFly: true,
      lint: this.getLinting.bind(this)
    };
  }

  getLinting(editor) {
    return this.linter != null ? this.linter.provideDiagnostics() : Promise.resolve([]);
  }

  // Nuclide Find References via LS findReferences

  provideFindReferences() {
    return {
      isEditorSupported: editor => true, // TODO: Grammar-select/extension based?
      findReferences: this.getReferences.bind(this)
    };
  }

  getReferences(editor, point) {
    return this.findReferences != null ? this.findReferences.getReferences(editor, point, this.getProjectRoot()) : Promise.resolve(null);
  }

  // Nuclide Hyperlick via LS gotoDefinition and documentHighlight

  provideHyperclick() {
    return {
      priority: 20,
      providerName: this.getName(),
      getSuggestion: this.getHyperclickSuggestion.bind(this)
    };
  }

  getHyperclickSuggestion(editor, point) {
    return this.hyperclick != null ? this.hyperclick.getSuggestion(editor, point) : Promise.resolve(null);
  }
};
exports.default = AutoBridge;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9hdXRvLWJyaWRnZS5qcyJdLCJuYW1lcyI6WyJjcCIsImxzIiwicnBjIiwiQXV0b0JyaWRnZSIsIl9kaXNwb3NhYmxlIiwiZ2V0TmFtZSIsImdldEdyYW1tYXJTY29wZXMiLCJhY3RpdmF0ZSIsImxvZ2dlciIsImF0b20iLCJjb25maWciLCJnZXQiLCJzdGFydFNlcnZlciIsImRlYWN0aXZhdGUiLCJkaXNwb3NlIiwiX2xjIiwic2h1dGRvd24iLCJfcHJvY2VzcyIsImtpbGwiLCJzdGFydFNlcnZlclByb2Nlc3MiLCJjb25uZWN0aW9uIiwiY3JlYXRlTWVzc2FnZUNvbm5lY3Rpb24iLCJTdHJlYW1NZXNzYWdlUmVhZGVyIiwic3Rkb3V0IiwiU3RyZWFtTWVzc2FnZVdyaXRlciIsInN0ZGluIiwiZXJyb3IiLCJtIiwiTGFuZ3VhZ2VDbGllbnRWMiIsIm9uTG9nTWVzc2FnZSIsImxvZyIsImluaXRpYWxpemVSZXNwb25zZSIsImluaXRpYWxpemUiLCJnZXRJbml0aWFsaXplUGFyYW1zIiwiYnJpZGdlQ2FwYWJpbGl0aWVzIiwiY2FwYWJpbGl0aWVzIiwicG9zdEluaXRpYWxpemF0aW9uIiwiZ2V0UHJvamVjdFJvb3QiLCJyb290RGlycyIsInByb2plY3QiLCJnZXREaXJlY3RvcmllcyIsImxlbmd0aCIsInBhdGgiLCJwcm9jZXNzSWQiLCJwcm9jZXNzIiwicGlkIiwicm9vdFBhdGgiLCJsaW50ZXIiLCJjb21wbGV0aW9uUHJvdmlkZXIiLCJhdXRvQ29tcGxldGUiLCJkZWZpbml0aW9uUHJvdmlkZXIiLCJkZWZpbml0aW9ucyIsImh5cGVyY2xpY2siLCJkb2N1bWVudFN5bWJvbFByb3ZpZGVyIiwib3V0bGluZVZpZXciLCJyZWZlcmVuY2VzUHJvdmlkZXIiLCJmaW5kUmVmZXJlbmNlcyIsInRleHREb2N1bWVudFN5bmMiLCJhZGQiLCJkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIiwiZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIiLCJJbml0aWFsaXphdGlvblJlc3VsdCIsInByb3ZpZGVBdXRvY29tcGxldGUiLCJzZWxlY3RvciIsImV4Y2x1ZGVMb3dlclByaW9yaXR5IiwiZ2V0U3VnZ2VzdGlvbnMiLCJiaW5kIiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicHJvdmlkZURlZmluaXRpb25zIiwibmFtZSIsInByaW9yaXR5IiwiZ3JhbW1hclNjb3BlcyIsImdldERlZmluaXRpb24iLCJnZXREZWZpbml0aW9uQnlJZCIsImVkaXRvciIsInBvaW50IiwiZmlsZW5hbWUiLCJpZCIsInByb3ZpZGVPdXRsaW5lcyIsImdldE91dGxpbmUiLCJwcm92aWRlTGludGVyIiwic2NvcGUiLCJsaW50T25GbHkiLCJsaW50IiwiZ2V0TGludGluZyIsInByb3ZpZGVEaWFnbm9zdGljcyIsInByb3ZpZGVGaW5kUmVmZXJlbmNlcyIsImlzRWRpdG9yU3VwcG9ydGVkIiwiZ2V0UmVmZXJlbmNlcyIsInByb3ZpZGVIeXBlcmNsaWNrIiwicHJvdmlkZXJOYW1lIiwiZ2V0U3VnZ2VzdGlvbiIsImdldEh5cGVyY2xpY2tTdWdnZXN0aW9uIl0sIm1hcHBpbmdzIjoiOzs7OztBQUVBOztJQUFZQSxFOztBQUNaOztJQUFZQyxFOztBQUNaOztJQUFZQyxHOztBQUVaOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7Ozs7Ozs7SUFFcUJDLFUsR0FBTixNQUFNQSxVQUFOLENBQWlCO0FBQUE7QUFBQSxTQUM5QkMsV0FEOEIsR0FDaEIsK0JBRGdCO0FBQUE7O0FBYzlCQyxZQUFVO0FBQUUsVUFBTSwrQ0FBTjtBQUF1RDtBQUNuRUMscUJBQW1CO0FBQUUsVUFBTSx3REFBTjtBQUFnRTs7QUFFckZDLGFBQWlCO0FBQ2YsU0FBS0MsTUFBTCxHQUFjQyxLQUFLQyxNQUFMLENBQVlDLEdBQVosQ0FBZ0IsZUFBaEIsSUFBbUMsNEJBQWtCLEtBQUtOLE9BQUws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Q3RELFdBQU87QUFDTEMseUJBQW9CYixNQUFELElBQTZCLElBRDNDLEVBQ2lEO0FBQ3REcEIsc0JBQWdCLEtBQUtrQyxhQUFMLENBQW1CeEIsSUFBbkIsQ0FBd0IsSUFBeEI7QUFGWCxLQUFQO0FBSUQ7O0FBRUR3QixnQkFBY2QsTUFBZCxFQUF1Q0MsS0FBdkMsRUFBa0c7QUFDaEcsV0FBTyxLQUFLckIsY0FBTCxJQUF1QixJQUF2QixHQUE4QixLQUFLQSxjQUFMLENBQW9Ca0MsYUFBcEIsQ0FBa0NkLE1BQWxDLEVBQTBDQyxLQUExQyxFQUFpRCxLQUFLeEMsY0FBTCxFQUFqRCxDQUE5QixHQUF3RytCLFFBQVFDLE9BQVIsQ0FBZ0IsSUFBaEIsQ0FBL0c7QUFDRDs7QUFFRDs7QUFFQXNCLHNCQUFnRDtBQUM5QyxXQUFPO0FBQ0xuQixnQkFBVSxFQURMO0FBRUxvQixvQkFBYyxLQUFLdkYsT0FBTCxFQUZUO0FBR0x3RixxQkFBZSxLQUFLQyx1QkFBTCxDQUE2QjVCLElBQTdCLENBQWtDLElBQWxDO0FBSFYsS0FBUDtBQUtEOztBQUVENEIsMEJBQXdCbEIsTUFBeEIsRUFBaURDLEtBQWpELEVBQTRHO0FBQzFHLFdBQU8sS0FBS3pCLFVBQUwsSUFBbUIsSUFBbkIsR0FBMEIsS0FBS0EsVUFBTCxDQUFnQnlDLGFBQWhCLENBQThCakIsTUFBOUIsRUFBc0NDLEtBQXRDLENBQTFCLEdBQXlFVCxRQUFRQyxPQUFSLENBQWdCLElBQWhCLENBQWhGO0FBQ0Q7QUE3TDZCLEM7a0JBQVhsRSxVIiwiZmlsZSI6ImF1dG8tYnJpZGdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCAqIGFzIGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuL3Byb3RvY29sL2xhbmd1YWdlY2xpZW50LXYyJztcclxuaW1wb3J0ICogYXMgcnBjIGZyb20gJ3ZzY29kZS1qc29ucnBjJztcclxuXHJcbmltcG9ydCBDb25zb2xlTG9nZ2VyIGZyb20gJy4vbG9nZ2Vycy9jb25zb2xlLWxvZ2dlcic7XHJcbmltcG9ydCBOdWxsTG9nZ2VyIGZyb20gJy4vbG9nZ2Vycy9udWxsLWxvZ2dlcic7XHJcblxyXG5pbXBvcnQgQXV0b2NvbXBsZXRlQnJpZGdlIGZyb20gJy4vYnJpZGdlcy9hdXRvY29tcGxldGUtYnJpZGdlJztcclxuaW1wb3J0IERvY3VtZW50U3luY0JyaWRnZSBmcm9tICcuL2JyaWRnZXMvZG9jdW1lbnQtc3luYy1icmlkZ2UnO1xyXG5pbXBvcnQgRm9ybWF0Q29kZUJyaWRnZSBmcm9tICcuL2JyaWRnZXMvZm9ybWF0LWNvZGUtYnJpZGdlJztcclxuaW1wb3J0IExpbnRlckJyaWRnZSBmcm9tICcuL2JyaWRnZXMvbGludGVyLWJyaWRnZSc7XHJcbmltcG9ydCBOb3RpZmljYXRpb25zQnJpZGdlIGZyb20gJy4vYnJpZGdlcy9ub3RpZmljYXRpb25zLWJyaWRnZSc7XHJcbmltcG9ydCBOdWNsaWRlRGVmaW5pdGlvbkJyaWRnZSBmcm9tICcuL2JyaWRnZXMvbnVjbGlkZS1kZWZpbml0aW9uLWJyaWRnZSc7XHJcbmltcG9ydCBOdWNsaWRlRmluZFJlZmVyZW5jZXNCcmlkZ2UgZnJvbSAnLi9icmlkZ2VzL251Y2xpZGUtZmluZC1yZWZlcmVuY2VzLWJyaWRnZSc7XHJcbmltcG9ydCBOdWNsaWRlSHlwZXJjbGlja0JyaWRnZSBmcm9tICcuL2JyaWRnZXMvbnVjbGlkZS1oeXBlcmNsaWNrLWJyaWRnZSc7XHJcbmltcG9ydCBOdWNsaWRlT3V0bGluZVZpZXdCcmlkZ2UgZnJvbSAnLi9icmlkZ2VzL251Y2xpZGUtb3V0bGluZS12aWV3LWJyaWRnZSc7XHJcblxyXG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2F0b20nO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b0JyaWRnZSB7XHJcbiAgX2Rpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xyXG4gIF9wcm9jZXNzOiA/Y2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3M7XHJcbiAgX2xjOiBscy5MYW5ndWFnZUNsaWVudFYyO1xyXG5cclxuICBhdXRvQ29tcGxldGU6ID9BdXRvY29tcGxldGVCcmlkZ2U7XHJcbiAgZGVmaW5pdGlvbnM6ID9OdWNsaWRlRGVmaW5pdGlvbkJyaWRnZTtcclxuICBmaW5kUmVmZXJlbmNlczogP051Y2xpZGVGaW5kUmVmZXJlbmNlc0JyaWRnZTtcclxuICBoeXBlcmNsaWNrOiA/TnVjbGlkZUh5cGVyY2xpY2tCcmlkZ2U7XHJcbiAgbGludGVyOiA/TGludGVyQnJpZGdlO1xyXG4gIG91dGxpbmVWaWV3OiA/TnVjbGlkZU91dGxpbmVWaWV3QnJpZGdlO1xyXG5cclxuICBsb2dnZXI6IENvbnNvbGVMb2dnZXIgfCBOdWxsTG9nZ2VyO1xyXG5cclxuICBnZXROYW1lKCkgeyB0aHJvdyBcIk11c3Qgc2V0IG5hbWUgZmllbGQgd2hlbiBleHRlbmRpbmcgQXV0b0JyaWRnZVwiIH07XHJcbiAgZ2V0R3JhbW1hclNjb3BlcygpIHsgdGhyb3cgXCJNdXN0IHNldCBncmFtbWFyU2NvcGVzIGZpZWxkIHdoZW4gZXh0ZW5kaW5nIEF1dG9CcmlkZ2VcIiB9O1xyXG5cclxuICBhY3RpdmF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nZ2VyID0gYXRvbS5jb25maWcuZ2V0KCdjb3JlLmRlYnVnTFNQJykgPyBuZXcgQ29uc29sZUxvZ2dlcih0aGlzLmdldE5hbWUoKSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gICAgdGhpcy5zdGFydFNlcnZlcigpO1xyXG4gIH1cclxuXHJcbiAgZGVhY3RpdmF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG5cclxuICAgIGlmICh0aGlzLl9sYykge1xyXG4gICAgICB0aGlzLl9sYy5zaHV0ZG93bigpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl9wcm9jZXNzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fcHJvY2Vzcy5raWxsKCk7XHJcbiAgICAgIHRoaXMuX3Byb2Nlc3MgPSBudWxsO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHN0YXJ0U2VydmVyKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKHRoaXMuX3Byb2Nlc3MgIT0gbnVsbCkgcmV0dXJuO1xyXG5cclxuICAgIHRoaXMuX3Byb2Nlc3MgPSBhd2FpdCB0aGlzLnN0YXJ0U2VydmVyUHJvY2VzcygpO1xyXG5cclxuICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBycGMuY3JlYXRlTWVzc2FnZUNvbm5lY3Rpb24oXHJcbiAgICAgIG5ldyBycGMuU3RyZWFtTWVzc2FnZVJlYWRlcih0aGlzLl9wcm9jZXNzLnN0ZG91dCksXHJcbiAgICAgIG5ldyBycGMuU3RyZWFtTWVzc2FnZVdyaXRlcih0aGlzLl9wcm9jZXNzLnN0ZGluKSxcclxuICAgICAgeyBlcnJvcjogKG06IE9iamVjdCkgPT4geyB0aGlzLmxvZ2dlci5lcnJvcihtKTsgfSB9KTtcclxuXHJcbiAgICB0aGlzLl9sYyA9IG5ldyBscy5MYW5ndWFnZUNsaWVudFYyKGNvbm5lY3Rpb24sIHRoaXMubG9nZ2VyKTtcclxuICAgIHRoaXMuX2xjLm9uTG9nTWVzc2FnZShtID0+IHRoaXMubG9nZ2VyLmxvZyhbJ0xvZycsIG1dKSk7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVJlc3BvbnNlID0gYXdhaXQgdGhpcy5fbGMuaW5pdGlhbGl6ZSh0aGlzLmdldEluaXRpYWxpemVQYXJhbXMoKSk7XHJcbiAgICB0aGlzLmJyaWRnZUNhcGFiaWxpdGllcyhpbml0aWFsaXplUmVzcG9uc2UuY2FwYWJpbGl0aWVzKTtcclxuICAgIHRoaXMucG9zdEluaXRpYWxpemF0aW9uKGluaXRpYWxpemVSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBzdGFydFNlcnZlclByb2Nlc3MoKTogY2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3Mge1xyXG4gICAgdGhyb3cgXCJNdXN0IG92ZXJyaWRlIHN0YXJ0U2VydmVyUHJvY2VzcyB0byBzdGFydCB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3Mgd2hlbiBleHRlbmRpbmcgQXV0b0JyaWRnZVwiO1xyXG4gIH1cclxuXHJcbiAgZ2V0UHJvamVjdFJvb3QoKTogP3N0cmluZyB7XHJcbiAgICBjb25zdCByb290RGlyczogQXJyYXk8YW55PiA9IGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpO1xyXG4gICAgcmV0dXJuIHJvb3REaXJzLmxlbmd0aCA+IDAgPyByb290RGlyc1swXS5wYXRoIDogbnVsbFxyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbGl6ZVBhcmFtcygpOiBscy5Jbml0aWFsaXplUGFyYW1zIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHByb2Nlc3NJZDogcHJvY2Vzcy5waWQsXHJcbiAgICAgIGNhcGFiaWxpdGllczogeyB9LFxyXG4gICAgICByb290UGF0aDogdGhpcy5nZXRQcm9qZWN0Um9vdCgpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYnJpZGdlQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllczogbHMuU2VydmVyQ2FwYWJpbGl0aWVzKTogdm9pZCB7XHJcbiAgICB0aGlzLmxpbnRlciA9IG5ldyBMaW50ZXJCcmlkZ2UodGhpcy5fbGMpO1xyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5jb21wbGV0aW9uUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5hdXRvQ29tcGxldGUgPSBuZXcgQXV0b2NvbXBsZXRlQnJpZGdlKHRoaXMuX2xjKTtcclxuICAgIH1cclxuICAgIGlmIChjYXBhYmlsaXRpZXMuZGVmaW5pdGlvblByb3ZpZGVyKSB7XHJcbiAgICAgIHRoaXMuZGVmaW5pdGlvbnMgPSBuZXcgTnVjbGlkZURlZmluaXRpb25CcmlkZ2UodGhpcy5fbGMpO1xyXG4gICAgICB0aGlzLmh5cGVyY2xpY2sgPSBuZXcgTnVjbGlkZUh5cGVyY2xpY2tCcmlkZ2UodGhpcy5fbGMpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5kb2N1bWVudFN5bWJvbFByb3ZpZGVyKSB7XHJcbiAgICAgIHRoaXMub3V0bGluZVZpZXcgPSBuZXcgTnVjbGlkZU91dGxpbmVWaWV3QnJpZGdlKHRoaXMuX2xjLCB0aGlzLmdldE5hbWUoKSk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2FwYWJpbGl0aWVzLnJlZmVyZW5jZXNQcm92aWRlcikge1xyXG4gICAgICB0aGlzLmZpbmRSZWZlcmVuY2VzID0gbmV3IE51Y2xpZGVGaW5kUmVmZXJlbmNlc0JyaWRnZSh0aGlzLl9sYyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmV3IE5vdGlmaWNhdGlvbnNCcmlkZ2UodGhpcy5fbGMsIHRoaXMuZ2V0TmFtZSgpKTtcclxuXHJcbiAgICBpZiAoY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMpIHtcclxuICAgICAgdGhpcy5fZGlzcG9zYWJsZS5hZGQobmV3IERvY3VtZW50U3luY0JyaWRnZSh0aGlzLl9sYywgY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMpKTtcclxuICAgIH1cclxuICAgIGlmIChjYXBhYmlsaXRpZXMuZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQcm92aWRlciB8fCBjYXBhYmlsaXRpZXMuZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5fZGlzcG9zYWJsZS5hZGQobmV3IEZvcm1hdENvZGVCcmlkZ2UodGhpcy5fbGMsIGNhcGFiaWxpdGllcy5kb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyID09PSB0cnVlLCBjYXBhYmlsaXRpZXMuZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIgPT09IHRydWUpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHBvc3RJbml0aWFsaXphdGlvbihJbml0aWFsaXphdGlvblJlc3VsdDogbHMuSW5pdGlhbGl6ZVJlc3VsdCk6IHZvaWQge1xyXG4gIH1cclxuXHJcbiAgLy8gQXRvbSBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uXHJcblxyXG4gIHByb3ZpZGVBdXRvY29tcGxldGUoKTogYXRvbSRBdXRvY29tcGxldGVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzZWxlY3RvcjogJy5zb3VyY2UnLFxyXG4gICAgICBleGNsdWRlTG93ZXJQcmlvcml0eTogZmFsc2UsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiB0aGlzLmdldFN1Z2dlc3Rpb25zLmJpbmQodGhpcylcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRTdWdnZXN0aW9ucyhyZXF1ZXN0OiBhbnkpOiBQcm9taXNlPEFycmF5PGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4+IHtcclxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZSAhPSBudWxsID8gdGhpcy5hdXRvQ29tcGxldGUuZ2V0U3VnZ2VzdGlvbnMocmVxdWVzdCkgOiBQcm9taXNlLnJlc29sdmUoW10pO1xyXG4gIH1cclxuXHJcbiAgLy8gTnVjbGlkZSBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uXHJcblxyXG4gIHByb3ZpZGVEZWZpbml0aW9ucygpOiBudWNsaWRlJERlZmluaXRpb25Qcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLmdldE5hbWUoKSxcclxuICAgICAgcHJpb3JpdHk6IDIwLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgZ2V0RGVmaW5pdGlvbjogdGhpcy5nZXREZWZpbml0aW9uLmJpbmQodGhpcyksXHJcbiAgICAgIGdldERlZmluaXRpb25CeUlkOiB0aGlzLmdldERlZmluaXRpb25CeUlkLmJpbmQodGhpcylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldERlZmluaXRpb24oZWRpdG9yOiBUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P251Y2xpZGUkRGVmaW5pdGlvblF1ZXJ5UmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9ucyAhPSBudWxsID8gdGhpcy5kZWZpbml0aW9ucy5nZXREZWZpbml0aW9uKGVkaXRvciwgcG9pbnQpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGVmaW5pdGlvbkJ5SWQoZmlsZW5hbWU6IE51Y2xpZGVVcmksIGlkOiBzdHJpbmcpOiBQcm9taXNlPD9udWNsaWRlJERlZmluaXRpb24+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7IC8vIFRPRE86IElzIHRoaXMgbmVlZGVkP1xyXG4gIH1cclxuXHJcbiAgLy8gTnVjbGlkZSBPdXRsaW5lIFZpZXcgdmlhIExTIGRvY3VtZW50U3ltYm9sXHJcblxyXG4gIHByb3ZpZGVPdXRsaW5lcygpOiBudWNsaWRlJE91dGxpbmVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLmdldE5hbWUoKSxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBnZXRPdXRsaW5lOiB0aGlzLmdldE91dGxpbmUuYmluZCh0aGlzKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldE91dGxpbmUoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpOiBQcm9taXNlPD9udWNsaWRlJE91dGxpbmU+IHtcclxuICAgIHJldHVybiB0aGlzLm91dGxpbmVWaWV3ICE9IG51bGwgPyB0aGlzLm91dGxpbmVWaWV3LmdldE91dGxpbmUoZWRpdG9yKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICB9XHJcblxyXG4gIC8vIExpbnRlciBBUEkgdmlhIExTIHB1Ymxpc2hEaWFnbm9zdGljc1xyXG5cclxuICBwcm92aWRlTGludGVyKCk6IGxpbnRlciRTdGFuZGFyZExpbnRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLmdldE5hbWUoKSxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHNjb3BlOiAncHJvamVjdCcsXHJcbiAgICAgIGxpbnRPbkZseTogdHJ1ZSxcclxuICAgICAgbGludDogdGhpcy5nZXRMaW50aW5nLmJpbmQodGhpcylcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRMaW50aW5nKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogP0FycmF5PGxpbnRlciRNZXNzYWdlPiB8IFByb21pc2U8P0FycmF5PGxpbnRlciRNZXNzYWdlPj4ge1xyXG4gICAgcmV0dXJuIHRoaXMubGludGVyICE9IG51bGwgPyB0aGlzLmxpbnRlci5wcm92aWRlRGlhZ25vc3RpY3MoKSA6IFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgfVxyXG5cclxuICAvLyBOdWNsaWRlIEZpbmQgUmVmZXJlbmNlcyB2aWEgTFMgZmluZFJlZmVyZW5jZXNcclxuXHJcbiAgcHJvdmlkZUZpbmRSZWZlcmVuY2VzKCk6IG51Y2xpZGUkRmluZFJlZmVyZW5jZXNQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKSA9PiB0cnVlLCAvLyBUT0RPOiBHcmFtbWFyLXNlbGVjdC9leHRlbnNpb24gYmFzZWQ/XHJcbiAgICAgIGZpbmRSZWZlcmVuY2VzOiB0aGlzLmdldFJlZmVyZW5jZXMuYmluZCh0aGlzKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0UmVmZXJlbmNlcyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9udWNsaWRlJEZpbmRSZWZlcmVuY2VzUmV0dXJuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5maW5kUmVmZXJlbmNlcyAhPSBudWxsID8gdGhpcy5maW5kUmVmZXJlbmNlcy5nZXRSZWZlcmVuY2VzKGVkaXRvciwgcG9pbnQsIHRoaXMuZ2V0UHJvamVjdFJvb3QoKSkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgfVxyXG5cclxuICAvLyBOdWNsaWRlIEh5cGVybGljayB2aWEgTFMgZ290b0RlZmluaXRpb24gYW5kIGRvY3VtZW50SGlnaGxpZ2h0XHJcblxyXG4gIHByb3ZpZGVIeXBlcmNsaWNrKCk6IG51Y2xpZGUkSHlwZXJjbGlja1Byb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHByaW9yaXR5OiAyMCxcclxuICAgICAgcHJvdmlkZXJOYW1lOiB0aGlzLmdldE5hbWUoKSxcclxuICAgICAgZ2V0U3VnZ2VzdGlvbjogdGhpcy5nZXRIeXBlcmNsaWNrU3VnZ2VzdGlvbi5iaW5kKHRoaXMpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0SHlwZXJjbGlja1N1Z2dlc3Rpb24oZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/bnVjbGlkZSRIeXBlcmNsaWNrU3VnZ2VzdGlvbj4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHlwZXJjbGljayAhPSBudWxsID8gdGhpcy5oeXBlcmNsaWNrLmdldFN1Z2dlc3Rpb24oZWRpdG9yLCBwb2ludCkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==