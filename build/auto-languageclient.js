Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _consoleLogger = require('./loggers/console-logger');

var _consoleLogger2 = _interopRequireDefault(_consoleLogger);

var _nullLogger = require('./loggers/null-logger');

var _nullLogger2 = _interopRequireDefault(_nullLogger);

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _formatCodeAdapter = require('./adapters/format-code-adapter');

var _formatCodeAdapter2 = _interopRequireDefault(_formatCodeAdapter);

var _linterAdapter = require('./adapters/linter-adapter');

var _linterAdapter2 = _interopRequireDefault(_linterAdapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _nuclideDefinitionAdapter = require('./adapters/nuclide-definition-adapter');

var _nuclideDefinitionAdapter2 = _interopRequireDefault(_nuclideDefinitionAdapter);

var _nuclideFindReferencesAdapter = require('./adapters/nuclide-find-references-adapter');

var _nuclideFindReferencesAdapter2 = _interopRequireDefault(_nuclideFindReferencesAdapter);

var _nuclideHyperclickAdapter = require('./adapters/nuclide-hyperclick-adapter');

var _nuclideHyperclickAdapter2 = _interopRequireDefault(_nuclideHyperclickAdapter);

var _nuclideOutlineViewAdapter = require('./adapters/nuclide-outline-view-adapter');

var _nuclideOutlineViewAdapter2 = _interopRequireDefault(_nuclideOutlineViewAdapter);

var _atom = require('atom');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

let AutoLanguageClient = class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
  }

  getGrammarScopes() {
    throw "Must implement getGrammarScopes when extending AutoLanguageClient";
  }
  getLanguageName() {
    throw "Must implement getLanguageName when extending AutoLanguageClient";
  }
  getServerName() {
    throw "Must implement getServerName when extending AutoLanguageClient";
  }

  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = atom.config.get('core.debugLSP') ? new _consoleLogger2.default(this.name) : new _nullLogger2.default();
    this.startServer();
  }

  deactivate() {
    this._disposable.dispose();

    if (this._lc) {
      this._lc.shutdown();
    }

    if (this._process != null) {
      this._process.kill();
      this._process = null;
    };
  }

  startServer() {
    var _this = this;

    return _asyncToGenerator(function* () {
      if (_this._process != null) return;

      _this._process = yield _this.startServerProcess();

      const connection = rpc.createMessageConnection(new rpc.StreamMessageReader(_this._process.stdout), new rpc.StreamMessageWriter(_this._process.stdin), { error: function (m) {
          _this.logger.error(m);
        } });

      _this._lc = new ls.LanguageClientConnection(connection, _this.logger);
      _this._lc.onLogMessage(function (m) {
        return _this.logger.log(['Log', m]);
      });

      const initializeResponse = yield _this._lc.initialize(_this.getInitializeParams());
      _this.adapterCapabilities(initializeResponse.capabilities);
      _this.postInitialization(initializeResponse);
    })();
  }

  startServerProcess() {
    throw "Must override startServerProcess to start the language server process when extending AutoLanguageClient";
  }

  getProjectRoot() {
    const rootDirs = atom.project.getDirectories();
    return rootDirs.length > 0 ? rootDirs[0].path : null;
  }

  getInitializeParams() {
    return {
      processId: process.pid,
      capabilities: {},
      rootPath: this.getProjectRoot()
    };
  }

  adapterCapabilities(capabilities) {
    this.linter = new _linterAdapter2.default(this._lc);
    if (capabilities.completionProvider) {
      this.autoComplete = new _autocompleteAdapter2.default(this._lc);
    }
    if (capabilities.definitionProvider) {
      this.definitions = new _nuclideDefinitionAdapter2.default(this._lc);
      this.hyperclick = new _nuclideHyperclickAdapter2.default(this._lc);
    }
    if (capabilities.documentSymbolProvider) {
      this.outlineView = new _nuclideOutlineViewAdapter2.default(this._lc, this.name);
    }
    if (capabilities.referencesProvider) {
      this.findReferences = new _nuclideFindReferencesAdapter2.default(this._lc);
    }

    new _notificationsAdapter2.default(this._lc, this.name);

    if (capabilities.textDocumentSync) {
      this._disposable.add(new _documentSyncAdapter2.default(this._lc, capabilities.textDocumentSync));
    }
    if (capabilities.documentRangeFormattingProvider || capabilities.documentFormattingProvider) {
      this._disposable.add(new _formatCodeAdapter2.default(this._lc, capabilities.documentRangeFormattingProvider === true, capabilities.documentFormattingProvider === true));
    }
  }

  postInitialization(InitializationResult) {}

  // Atom Autocomplete+ via LS completion

  provideAutocomplete() {
    return {
      selector: '.source',
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  getSuggestions(request) {
    return this.autoComplete != null ? this.autoComplete.getSuggestions(request) : Promise.resolve([]);
  }

  // Nuclide Definitions via LS documentHighlight and gotoDefinition

  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this),
      getDefinitionById: this.getDefinitionById.bind(this)
    };
  }

  getDefinition(editor, point) {
    return this.definitions != null ? this.definitions.getDefinition(editor, point) : Promise.resolve(null);
  }

  getDefinitionById(filename, id) {
    return Promise.resolve(null); // TODO: Is this needed?
  }

  // Nuclide Outline View via LS documentSymbol

  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  getOutline(editor) {
    return this.outlineView != null ? this.outlineView.getOutline(editor) : Promise.resolve(null);
  }

  // Linter API via LS publishDiagnostics

  provideLinter() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      scope: 'project',
      lintOnFly: true,
      lint: this.getLinting.bind(this)
    };
  }

  getLinting(editor) {
    return this.linter != null ? this.linter.provideDiagnostics() : Promise.resolve([]);
  }

  // Nuclide Find References via LS findReferences

  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  getReferences(editor, point) {
    return this.findReferences != null ? this.findReferences.getReferences(editor, point, this.getProjectRoot()) : Promise.resolve(null);
  }

  // Nuclide Hyperlick via LS gotoDefinition and documentHighlight

  provideHyperclick() {
    return {
      priority: 20,
      providerName: this.name,
      getSuggestion: this.getHyperclickSuggestion.bind(this)
    };
  }

  getHyperclickSuggestion(editor, point) {
    return this.hyperclick != null ? this.hyperclick.getSuggestion(editor, point) : Promise.resolve(null);
  }
};
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsImdldEdyYW1tYXJTY29wZXMiLCJnZXRMYW5ndWFnZU5hbWUiLCJnZXRTZXJ2ZXJOYW1lIiwiYWN0aXZhdGUiLCJuYW1lIiwibG9nZ2VyIiwiYXRvbSIsImNvbmZpZyIsImdldCIsInN0YXJ0U2VydmVyIiwiZGVhY3RpdmF0ZSIsImRpc3Bvc2UiLCJfbGMiLCJzaHV0ZG93biIsIl9wcm9jZXNzIiwia2lsbCIsInN0YXJ0U2VydmVyUHJvY2VzcyIsImNvbm5lY3Rpb24iLCJjcmVhdGVNZXNzYWdlQ29ubmVjdGlvbiIsIlN0cmVhbU1lc3NhZ2VSZWFkZXIiLCJzdGRvdXQiLCJTdHJlYW1NZXNzYWdlV3JpdGVyIiwic3RkaW4iLCJlcnJvciIsIm0iLCJMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24iLCJvbkxvZ01lc3NhZ2UiLCJsb2ciLCJpbml0aWFsaXplUmVzcG9uc2UiLCJpbml0aWFsaXplIiwiZ2V0SW5pdGlhbGl6ZVBhcmFtcyIsImFkYXB0ZXJDYXBhYmlsaXRpZXMiLCJjYXBhYmlsaXRpZXMiLCJwb3N0SW5pdGlhbGl6YXRpb24iLCJnZXRQcm9qZWN0Um9vdCIsInJvb3REaXJzIiwicHJvamVjdCIsImdldERpcmVjdG9yaWVzIiwibGVuZ3RoIiwicGF0aCIsInByb2Nlc3NJZCIsInByb2Nlc3MiLCJwaWQiLCJyb290UGF0aCIsImxpbnRlciIsImNvbXBsZXRpb25Qcm92aWRlciIsImF1dG9Db21wbGV0ZSIsImRlZmluaXRpb25Qcm92aWRlciIsImRlZmluaXRpb25zIiwiaHlwZXJjbGljayIsImRvY3VtZW50U3ltYm9sUHJvdmlkZXIiLCJvdXRsaW5lVmlldyIsInJlZmVyZW5jZXNQcm92aWRlciIsImZpbmRSZWZlcmVuY2VzIiwidGV4dERvY3VtZW50U3luYyIsImFkZCIsImRvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUHJvdmlkZXIiLCJkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlciIsIkluaXRpYWxpemF0aW9uUmVzdWx0IiwicHJvdmlkZUF1dG9jb21wbGV0ZSIsInNlbGVjdG9yIiwiZXhjbHVkZUxvd2VyUHJpb3JpdHkiLCJnZXRTdWdnZXN0aW9ucyIsImJpbmQiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJwcm92aWRlRGVmaW5pdGlvbnMiLCJwcmlvcml0eSIsImdyYW1tYXJTY29wZXMiLCJnZXREZWZpbml0aW9uIiwiZ2V0RGVmaW5pdGlvbkJ5SWQiLCJlZGl0b3IiLCJwb2ludCIsImZpbGVuYW1lIiwiaWQiLCJwcm92aWRlT3V0bGluZXMiLCJnZXRPdXRsaW5lIiwicHJvdmlkZUxpbnRlciIsInNjb3BlIiwibGludE9uRmx5IiwibGludCIsImdldExpbnRpbmciLCJwcm92aWRlRGlhZ25vc3RpY3MiLCJwcm92aWRlRmluZFJlZmVyZW5jZXMiLCJpc0VkaXRvclN1cHBvcnRlZCIsImluY2x1ZGVzIiwiZ2V0R3JhbW1hciIsInNjb3BlTmFtZSIsImdldFJlZmVyZW5jZXMiLCJwcm92aWRlSHlwZXJjbGljayIsInByb3ZpZGVyTmFtZSIsImdldFN1Z2dlc3Rpb24iLCJnZXRIeXBlcmNsaWNrU3VnZ2VzdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQTs7SUFBWUEsRTs7QUFDWjs7SUFBWUMsRTs7QUFDWjs7SUFBWUMsRzs7QUFFWjs7OztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7Ozs7Ozs7O0lBRXFCQyxrQixHQUFOLE1BQU1BLGtCQUFOLENBQXlCO0FBQUE7QUFBQSxTQUN0Q0MsV0FEc0MsR0FDeEIsK0JBRHdCO0FBQUE7O0FBZ0J0Q0MscUJBQWtDO0FBQUUsVUFBTSxtRUFBTjtBQUEyRTtBQUMvR0Msb0JBQTBCO0FBQUUsVUFBTSxrRUFBTjtBQUEwRTtBQUN0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dWFnZWNsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XHJcblxyXG5pbXBvcnQgKiBhcyBjcCBmcm9tICdjaGlsZF9wcm9jZXNzJztcclxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCAqIGFzIHJwYyBmcm9tICd2c2NvZGUtanNvbnJwYyc7XHJcblxyXG5pbXBvcnQgQ29uc29sZUxvZ2dlciBmcm9tICcuL2xvZ2dlcnMvY29uc29sZS1sb2dnZXInO1xyXG5pbXBvcnQgTnVsbExvZ2dlciBmcm9tICcuL2xvZ2dlcnMvbnVsbC1sb2dnZXInO1xyXG5cclxuaW1wb3J0IEF1dG9jb21wbGV0ZUFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlcic7XHJcbmltcG9ydCBEb2N1bWVudFN5bmNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZG9jdW1lbnQtc3luYy1hZGFwdGVyJztcclxuaW1wb3J0IEZvcm1hdENvZGVBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZm9ybWF0LWNvZGUtYWRhcHRlcic7XHJcbmltcG9ydCBMaW50ZXJBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbGludGVyLWFkYXB0ZXInO1xyXG5pbXBvcnQgTm90aWZpY2F0aW9uc0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9ub3RpZmljYXRpb25zLWFkYXB0ZXInO1xyXG5pbXBvcnQgTnVjbGlkZURlZmluaXRpb25BZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbnVjbGlkZS1kZWZpbml0aW9uLWFkYXB0ZXInO1xyXG5pbXBvcnQgTnVjbGlkZUZpbmRSZWZlcmVuY2VzQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL251Y2xpZGUtZmluZC1yZWZlcmVuY2VzLWFkYXB0ZXInO1xyXG5pbXBvcnQgTnVjbGlkZUh5cGVyY2xpY2tBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbnVjbGlkZS1oeXBlcmNsaWNrLWFkYXB0ZXInO1xyXG5pbXBvcnQgTnVjbGlkZU91dGxpbmVWaWV3QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL251Y2xpZGUtb3V0bGluZS12aWV3LWFkYXB0ZXInO1xyXG5cclxuaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdhdG9tJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dG9MYW5ndWFnZUNsaWVudCB7XHJcbiAgX2Rpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xyXG4gIF9wcm9jZXNzOiA/Y2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3M7XHJcbiAgX2xjOiBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb247XHJcblxyXG4gIGF1dG9Db21wbGV0ZTogP0F1dG9jb21wbGV0ZUFkYXB0ZXI7XHJcbiAgbGludGVyOiA/TGludGVyQWRhcHRlcjtcclxuXHJcbiAgZGVmaW5pdGlvbnM6ID9OdWNsaWRlRGVmaW5pdGlvbkFkYXB0ZXI7XHJcbiAgZmluZFJlZmVyZW5jZXM6ID9OdWNsaWRlRmluZFJlZmVyZW5jZXNBZGFwdGVyO1xyXG4gIGh5cGVyY2xpY2s6ID9OdWNsaWRlSHlwZXJjbGlja0FkYXB0ZXI7XHJcbiAgb3V0bGluZVZpZXc6ID9OdWNsaWRlT3V0bGluZVZpZXdBZGFwdGVyO1xyXG5cclxuICBsb2dnZXI6IENvbnNvbGVMb2dnZXIgfCBOdWxsTG9nZ2VyO1xyXG4gIG5hbWU6IHN0cmluZztcclxuXHJcbiAgZ2V0R3JhbW1hclNjb3BlcygpOiBBcnJheTxzdHJpbmc+IHsgdGhyb3cgXCJNdXN0IGltcGxlbWVudCBnZXRHcmFtbWFyU2NvcGVzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudFwiIH07XHJcbiAgZ2V0TGFuZ3VhZ2VOYW1lKCk6IHN0cmluZyB7IHRocm93IFwiTXVzdCBpbXBsZW1lbnQgZ2V0TGFuZ3VhZ2VOYW1lIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudFwiIH07XHJcbiAgZ2V0U2VydmVyTmFtZSgpOiBzdHJpbmcgeyB0aHJvdyBcIk11c3QgaW1wbGVtZW50IGdldFNlcnZlck5hbWUgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50XCIgfTtcclxuXHJcbiAgYWN0aXZhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5hbWUgPSBgJHt0aGlzLmdldExhbmd1YWdlTmFtZSgpfSAoJHt0aGlzLmdldFNlcnZlck5hbWUoKX0pYDtcclxuICAgIHRoaXMubG9nZ2VyID0gYXRvbS5jb25maWcuZ2V0KCdjb3JlLmRlYnVnTFNQJykgPyBuZXcgQ29uc29sZUxvZ2dlcih0aGlzLm5hbWUpIDogbmV3IE51bGxMb2dnZXIoKTtcclxuICAgIHRoaXMuc3RhcnRTZXJ2ZXIoKTtcclxuICB9XHJcblxyXG4gIGRlYWN0aXZhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlLmRpc3Bvc2UoKTtcclxuXHJcbiAgICBpZiAodGhpcy5fbGMpIHtcclxuICAgICAgdGhpcy5fbGMuc2h1dGRvd24oKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5fcHJvY2VzcyAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX3Byb2Nlc3Mua2lsbCgpO1xyXG4gICAgICB0aGlzLl9wcm9jZXNzID0gbnVsbDtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBzdGFydFNlcnZlcigpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICh0aGlzLl9wcm9jZXNzICE9IG51bGwpIHJldHVybjtcclxuXHJcbiAgICB0aGlzLl9wcm9jZXNzID0gYXdhaXQgdGhpcy5zdGFydFNlcnZlclByb2Nlc3MoKTtcclxuXHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gcnBjLmNyZWF0ZU1lc3NhZ2VDb25uZWN0aW9uKFxyXG4gICAgICBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VSZWFkZXIodGhpcy5fcHJvY2Vzcy5zdGRvdXQpLFxyXG4gICAgICBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VXcml0ZXIodGhpcy5fcHJvY2Vzcy5zdGRpbiksXHJcbiAgICAgIHsgZXJyb3I6IChtOiBPYmplY3QpID0+IHsgdGhpcy5sb2dnZXIuZXJyb3IobSk7IH0gfSk7XHJcblxyXG4gICAgdGhpcy5fbGMgPSBuZXcgbHMuTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uKGNvbm5lY3Rpb24sIHRoaXMubG9nZ2VyKTtcclxuICAgIHRoaXMuX2xjLm9uTG9nTWVzc2FnZShtID0+IHRoaXMubG9nZ2VyLmxvZyhbJ0xvZycsIG1dKSk7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVJlc3BvbnNlID0gYXdhaXQgdGhpcy5fbGMuaW5pdGlhbGl6ZSh0aGlzLmdldEluaXRpYWxpemVQYXJhbXMoKSk7XHJcbiAgICB0aGlzLmFkYXB0ZXJDYXBhYmlsaXRpZXMoaW5pdGlhbGl6ZVJlc3BvbnNlLmNhcGFiaWxpdGllcyk7XHJcbiAgICB0aGlzLnBvc3RJbml0aWFsaXphdGlvbihpbml0aWFsaXplUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgc3RhcnRTZXJ2ZXJQcm9jZXNzKCk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHtcclxuICAgIHRocm93IFwiTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgdGhlIGxhbmd1YWdlIHNlcnZlciBwcm9jZXNzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudFwiO1xyXG4gIH1cclxuXHJcbiAgZ2V0UHJvamVjdFJvb3QoKTogP3N0cmluZyB7XHJcbiAgICBjb25zdCByb290RGlyczogQXJyYXk8YW55PiA9IGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpO1xyXG4gICAgcmV0dXJuIHJvb3REaXJzLmxlbmd0aCA+IDAgPyByb290RGlyc1swXS5wYXRoIDogbnVsbFxyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbGl6ZVBhcmFtcygpOiBscy5Jbml0aWFsaXplUGFyYW1zIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHByb2Nlc3NJZDogcHJvY2Vzcy5waWQsXHJcbiAgICAgIGNhcGFiaWxpdGllczogeyB9LFxyXG4gICAgICByb290UGF0aDogdGhpcy5nZXRQcm9qZWN0Um9vdCgpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYWRhcHRlckNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXM6IGxzLlNlcnZlckNhcGFiaWxpdGllcyk6IHZvaWQge1xyXG4gICAgdGhpcy5saW50ZXIgPSBuZXcgTGludGVyQWRhcHRlcih0aGlzLl9sYyk7XHJcbiAgICBpZiAoY2FwYWJpbGl0aWVzLmNvbXBsZXRpb25Qcm92aWRlcikge1xyXG4gICAgICB0aGlzLmF1dG9Db21wbGV0ZSA9IG5ldyBBdXRvY29tcGxldGVBZGFwdGVyKHRoaXMuX2xjKTtcclxuICAgIH1cclxuICAgIGlmIChjYXBhYmlsaXRpZXMuZGVmaW5pdGlvblByb3ZpZGVyKSB7XHJcbiAgICAgIHRoaXMuZGVmaW5pdGlvbnMgPSBuZXcgTnVjbGlkZURlZmluaXRpb25BZGFwdGVyKHRoaXMuX2xjKTtcclxuICAgICAgdGhpcy5oeXBlcmNsaWNrID0gbmV3IE51Y2xpZGVIeXBlcmNsaWNrQWRhcHRlcih0aGlzLl9sYyk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2FwYWJpbGl0aWVzLmRvY3VtZW50U3ltYm9sUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5vdXRsaW5lVmlldyA9IG5ldyBOdWNsaWRlT3V0bGluZVZpZXdBZGFwdGVyKHRoaXMuX2xjLCB0aGlzLm5hbWUpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5yZWZlcmVuY2VzUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5maW5kUmVmZXJlbmNlcyA9IG5ldyBOdWNsaWRlRmluZFJlZmVyZW5jZXNBZGFwdGVyKHRoaXMuX2xjKTtcclxuICAgIH1cclxuXHJcbiAgICBuZXcgTm90aWZpY2F0aW9uc0FkYXB0ZXIodGhpcy5fbGMsIHRoaXMubmFtZSk7XHJcblxyXG4gICAgaWYgKGNhcGFiaWxpdGllcy50ZXh0RG9jdW1lbnRTeW5jKSB7XHJcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGUuYWRkKG5ldyBEb2N1bWVudFN5bmNBZGFwdGVyKHRoaXMuX2xjLCBjYXBhYmlsaXRpZXMudGV4dERvY3VtZW50U3luYykpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5kb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIHx8IGNhcGFiaWxpdGllcy5kb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlcikge1xyXG4gICAgICB0aGlzLl9kaXNwb3NhYmxlLmFkZChuZXcgRm9ybWF0Q29kZUFkYXB0ZXIodGhpcy5fbGMsIGNhcGFiaWxpdGllcy5kb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyID09PSB0cnVlLCBjYXBhYmlsaXRpZXMuZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIgPT09IHRydWUpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHBvc3RJbml0aWFsaXphdGlvbihJbml0aWFsaXphdGlvblJlc3VsdDogbHMuSW5pdGlhbGl6ZVJlc3VsdCk6IHZvaWQge1xyXG4gIH1cclxuXHJcbiAgLy8gQXRvbSBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uXHJcblxyXG4gIHByb3ZpZGVBdXRvY29tcGxldGUoKTogYXRvbSRBdXRvY29tcGxldGVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzZWxlY3RvcjogJy5zb3VyY2UnLFxyXG4gICAgICBleGNsdWRlTG93ZXJQcmlvcml0eTogZmFsc2UsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiB0aGlzLmdldFN1Z2dlc3Rpb25zLmJpbmQodGhpcylcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRTdWdnZXN0aW9ucyhyZXF1ZXN0OiBhbnkpOiBQcm9taXNlPEFycmF5PGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4+IHtcclxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZSAhPSBudWxsID8gdGhpcy5hdXRvQ29tcGxldGUuZ2V0U3VnZ2VzdGlvbnMocmVxdWVzdCkgOiBQcm9taXNlLnJlc29sdmUoW10pO1xyXG4gIH1cclxuXHJcbiAgLy8gTnVjbGlkZSBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uXHJcblxyXG4gIHByb3ZpZGVEZWZpbml0aW9ucygpOiBudWNsaWRlJERlZmluaXRpb25Qcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIHByaW9yaXR5OiAyMCxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIGdldERlZmluaXRpb246IHRoaXMuZ2V0RGVmaW5pdGlvbi5iaW5kKHRoaXMpLFxyXG4gICAgICBnZXREZWZpbml0aW9uQnlJZDogdGhpcy5nZXREZWZpbml0aW9uQnlJZC5iaW5kKHRoaXMpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXREZWZpbml0aW9uKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9udWNsaWRlJERlZmluaXRpb25RdWVyeVJlc3VsdD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbnMgIT0gbnVsbCA/IHRoaXMuZGVmaW5pdGlvbnMuZ2V0RGVmaW5pdGlvbihlZGl0b3IsIHBvaW50KSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICB9XHJcblxyXG4gIGdldERlZmluaXRpb25CeUlkKGZpbGVuYW1lOiBOdWNsaWRlVXJpLCBpZDogc3RyaW5nKTogUHJvbWlzZTw/bnVjbGlkZSREZWZpbml0aW9uPiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpOyAvLyBUT0RPOiBJcyB0aGlzIG5lZWRlZD9cclxuICB9XHJcblxyXG4gIC8vIE51Y2xpZGUgT3V0bGluZSBWaWV3IHZpYSBMUyBkb2N1bWVudFN5bWJvbFxyXG5cclxuICBwcm92aWRlT3V0bGluZXMoKTogbnVjbGlkZSRPdXRsaW5lUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgIGdldE91dGxpbmU6IHRoaXMuZ2V0T3V0bGluZS5iaW5kKHRoaXMpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0T3V0bGluZShlZGl0b3I6IGF0b20kVGV4dEVkaXRvcik6IFByb21pc2U8P251Y2xpZGUkT3V0bGluZT4ge1xyXG4gICAgcmV0dXJuIHRoaXMub3V0bGluZVZpZXcgIT0gbnVsbCA/IHRoaXMub3V0bGluZVZpZXcuZ2V0T3V0bGluZShlZGl0b3IpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gIH1cclxuXHJcbiAgLy8gTGludGVyIEFQSSB2aWEgTFMgcHVibGlzaERpYWdub3N0aWNzXHJcblxyXG4gIHByb3ZpZGVMaW50ZXIoKTogbGludGVyJFN0YW5kYXJkTGludGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHNjb3BlOiAncHJvamVjdCcsXHJcbiAgICAgIGxpbnRPbkZseTogdHJ1ZSxcclxuICAgICAgbGludDogdGhpcy5nZXRMaW50aW5nLmJpbmQodGhpcylcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRMaW50aW5nKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogP0FycmF5PGxpbnRlciRNZXNzYWdlPiB8IFByb21pc2U8P0FycmF5PGxpbnRlciRNZXNzYWdlPj4ge1xyXG4gICAgcmV0dXJuIHRoaXMubGludGVyICE9IG51bGwgPyB0aGlzLmxpbnRlci5wcm92aWRlRGlhZ25vc3RpY3MoKSA6IFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgfVxyXG5cclxuICAvLyBOdWNsaWRlIEZpbmQgUmVmZXJlbmNlcyB2aWEgTFMgZmluZFJlZmVyZW5jZXNcclxuXHJcbiAgcHJvdmlkZUZpbmRSZWZlcmVuY2VzKCk6IG51Y2xpZGUkRmluZFJlZmVyZW5jZXNQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKSA9PiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhlZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSksXHJcbiAgICAgIGZpbmRSZWZlcmVuY2VzOiB0aGlzLmdldFJlZmVyZW5jZXMuYmluZCh0aGlzKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0UmVmZXJlbmNlcyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9udWNsaWRlJEZpbmRSZWZlcmVuY2VzUmV0dXJuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5maW5kUmVmZXJlbmNlcyAhPSBudWxsID8gdGhpcy5maW5kUmVmZXJlbmNlcy5nZXRSZWZlcmVuY2VzKGVkaXRvciwgcG9pbnQsIHRoaXMuZ2V0UHJvamVjdFJvb3QoKSkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgfVxyXG5cclxuICAvLyBOdWNsaWRlIEh5cGVybGljayB2aWEgTFMgZ290b0RlZmluaXRpb24gYW5kIGRvY3VtZW50SGlnaGxpZ2h0XHJcblxyXG4gIHByb3ZpZGVIeXBlcmNsaWNrKCk6IG51Y2xpZGUkSHlwZXJjbGlja1Byb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHByaW9yaXR5OiAyMCxcclxuICAgICAgcHJvdmlkZXJOYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb246IHRoaXMuZ2V0SHlwZXJjbGlja1N1Z2dlc3Rpb24uYmluZCh0aGlzKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldEh5cGVyY2xpY2tTdWdnZXN0aW9uKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P251Y2xpZGUkSHlwZXJjbGlja1N1Z2dlc3Rpb24+IHtcclxuICAgIHJldHVybiB0aGlzLmh5cGVyY2xpY2sgIT0gbnVsbCA/IHRoaXMuaHlwZXJjbGljay5nZXRTdWdnZXN0aW9uKGVkaXRvciwgcG9pbnQpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gIH1cclxufVxyXG4iXX0=