Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _consoleLogger = require('./loggers/console-logger');

var _consoleLogger2 = _interopRequireDefault(_consoleLogger);

var _nullLogger = require('./loggers/null-logger');

var _nullLogger2 = _interopRequireDefault(_nullLogger);

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _formatCodeAdapter = require('./adapters/format-code-adapter');

var _formatCodeAdapter2 = _interopRequireDefault(_formatCodeAdapter);

var _linterAdapter = require('./adapters/linter-adapter');

var _linterAdapter2 = _interopRequireDefault(_linterAdapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _nuclideDefinitionAdapter = require('./adapters/nuclide-definition-adapter');

var _nuclideDefinitionAdapter2 = _interopRequireDefault(_nuclideDefinitionAdapter);

var _nuclideFindReferencesAdapter = require('./adapters/nuclide-find-references-adapter');

var _nuclideFindReferencesAdapter2 = _interopRequireDefault(_nuclideFindReferencesAdapter);

var _nuclideHyperclickAdapter = require('./adapters/nuclide-hyperclick-adapter');

var _nuclideHyperclickAdapter2 = _interopRequireDefault(_nuclideHyperclickAdapter);

var _nuclideOutlineViewAdapter = require('./adapters/nuclide-outline-view-adapter');

var _nuclideOutlineViewAdapter2 = _interopRequireDefault(_nuclideOutlineViewAdapter);

var _atom = require('atom');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

let AutoLanguageClient = class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
  }

  getGrammarScopes() {
    throw "Must implement getGrammarScopes when extending AutoLanguageClient";
  }
  getLanguageName() {
    throw "Must implement getLanguageName when extending AutoLanguageClient";
  }
  getServerName() {
    throw "Must implement getServerName when extending AutoLanguageClient";
  }

  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = atom.config.get('core.debugLSP') ? new _consoleLogger2.default(this.name) : new _nullLogger2.default();
    this.startServer();
  }

  deactivate() {
    this._disposable.dispose();

    if (this._lc) {
      this._lc.shutdown();
    }

    if (this._process != null) {
      this._process.kill();
      this._process = null;
    };
  }

  startServer() {
    var _this = this;

    return _asyncToGenerator(function* () {
      if (_this._process != null) return;

      _this._process = yield _this.startServerProcess();

      const connection = rpc.createMessageConnection(new rpc.StreamMessageReader(_this._process.stdout), new rpc.StreamMessageWriter(_this._process.stdin), { error: function (m) {
          _this.logger.error(m);
        } });

      _this._lc = new ls.LanguageClientConnection(connection, _this.logger);
      _this._lc.onLogMessage(function (m) {
        return _this.logger.log(['Log', m]);
      });

      const initializeResponse = yield _this._lc.initialize(_this.getInitializeParams());
      _this.adaptCapabilities(initializeResponse.capabilities);
      _this.postInitialization(initializeResponse);
    })();
  }

  startServerProcess() {
    throw "Must override startServerProcess to start the language server process when extending AutoLanguageClient";
  }

  getProjectRoot() {
    const rootDirs = atom.project.getDirectories();
    return rootDirs.length > 0 ? rootDirs[0].path : null;
  }

  getInitializeParams() {
    return {
      processId: process.pid,
      capabilities: {},
      rootPath: this.getProjectRoot()
    };
  }

  adaptCapabilities(capabilities) {
    this.linter = new _linterAdapter2.default(this._lc);
    if (capabilities.completionProvider) {
      this.autoComplete = new _autocompleteAdapter2.default(this._lc);
    }
    if (capabilities.definitionProvider) {
      this.definitions = new _nuclideDefinitionAdapter2.default(this._lc);
      this.hyperclick = new _nuclideHyperclickAdapter2.default(this._lc);
    }
    if (capabilities.documentSymbolProvider) {
      this.outlineView = new _nuclideOutlineViewAdapter2.default(this._lc, this.name);
    }
    if (capabilities.referencesProvider) {
      this.findReferences = new _nuclideFindReferencesAdapter2.default(this._lc);
    }

    new _notificationsAdapter2.default(this._lc, this.name);

    if (capabilities.textDocumentSync) {
      this._disposable.add(new _documentSyncAdapter2.default(this._lc, capabilities.textDocumentSync));
    }
    if (capabilities.documentRangeFormattingProvider || capabilities.documentFormattingProvider) {
      this._disposable.add(new _formatCodeAdapter2.default(this._lc, capabilities.documentRangeFormattingProvider === true, capabilities.documentFormattingProvider === true, this.getGrammarScopes()));
    }
  }

  postInitialization(InitializationResult) {}

  // Atom Autocomplete+ via LS completion

  provideAutocomplete() {
    return {
      selector: '.source',
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  getSuggestions(request) {
    return this.autoComplete != null ? this.autoComplete.getSuggestions(request) : Promise.resolve([]);
  }

  // Nuclide Definitions via LS documentHighlight and gotoDefinition

  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this),
      getDefinitionById: this.getDefinitionById.bind(this)
    };
  }

  getDefinition(editor, point) {
    return this.definitions != null ? this.definitions.getDefinition(editor, point) : Promise.resolve(null);
  }

  getDefinitionById(filename, id) {
    return Promise.resolve(null); // TODO: Is this needed?
  }

  // Nuclide Outline View via LS documentSymbol

  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  getOutline(editor) {
    return this.outlineView != null ? this.outlineView.getOutline(editor) : Promise.resolve(null);
  }

  // Linter API via LS publishDiagnostics

  provideLinter() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      scope: 'project',
      lintOnFly: true,
      lint: this.getLinting.bind(this)
    };
  }

  getLinting(editor) {
    return this.linter != null ? this.linter.provideDiagnostics() : Promise.resolve([]);
  }

  // Nuclide Find References via LS findReferences

  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  getReferences(editor, point) {
    return this.findReferences != null ? this.findReferences.getReferences(editor, point, this.getProjectRoot()) : Promise.resolve(null);
  }

  // Nuclide Hyperlick via LS gotoDefinition and documentHighlight

  provideHyperclick() {
    return {
      priority: 20,
      providerName: this.name,
      getSuggestion: this.getHyperclickSuggestion.bind(this)
    };
  }

  getHyperclickSuggestion(editor, point) {
    return this.hyperclick != null ? this.hyperclick.getSuggestion(editor, point) : Promise.resolve(null);
  }
};
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsImdldEdyYW1tYXJTY29wZXMiLCJnZXRMYW5ndWFnZU5hbWUiLCJnZXRTZXJ2ZXJOYW1lIiwiYWN0aXZhdGUiLCJuYW1lIiwibG9nZ2VyIiwiYXRvbSIsImNvbmZpZyIsImdldCIsInN0YXJ0U2VydmVyIiwiZGVhY3RpdmF0ZSIsImRpc3Bvc2UiLCJfbGMiLCJzaHV0ZG93biIsIl9wcm9jZXNzIiwia2lsbCIsInN0YXJ0U2VydmVyUHJvY2VzcyIsImNvbm5lY3Rpb24iLCJjcmVhdGVNZXNzYWdlQ29ubmVjdGlvbiIsIlN0cmVhbU1lc3NhZ2VSZWFkZXIiLCJzdGRvdXQiLCJTdHJlYW1NZXNzYWdlV3JpdGVyIiwic3RkaW4iLCJlcnJvciIsIm0iLCJMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24iLCJvbkxvZ01lc3NhZ2UiLCJsb2ciLCJpbml0aWFsaXplUmVzcG9uc2UiLCJpbml0aWFsaXplIiwiZ2V0SW5pdGlhbGl6ZVBhcmFtcyIsImFkYXB0Q2FwYWJpbGl0aWVzIiwiY2FwYWJpbGl0aWVzIiwicG9zdEluaXRpYWxpemF0aW9uIiwiZ2V0UHJvamVjdFJvb3QiLCJyb290RGlycyIsInByb2plY3QiLCJnZXREaXJlY3RvcmllcyIsImxlbmd0aCIsInBhdGgiLCJwcm9jZXNzSWQiLCJwcm9jZXNzIiwicGlkIiwicm9vdFBhdGgiLCJsaW50ZXIiLCJjb21wbGV0aW9uUHJvdmlkZXIiLCJhdXRvQ29tcGxldGUiLCJkZWZpbml0aW9uUHJvdmlkZXIiLCJkZWZpbml0aW9ucyIsImh5cGVyY2xpY2siLCJkb2N1bWVudFN5bWJvbFByb3ZpZGVyIiwib3V0bGluZVZpZXciLCJyZWZlcmVuY2VzUHJvdmlkZXIiLCJmaW5kUmVmZXJlbmNlcyIsInRleHREb2N1bWVudFN5bmMiLCJhZGQiLCJkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIiwiZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIiLCJJbml0aWFsaXphdGlvblJlc3VsdCIsInByb3ZpZGVBdXRvY29tcGxldGUiLCJzZWxlY3RvciIsImV4Y2x1ZGVMb3dlclByaW9yaXR5IiwiZ2V0U3VnZ2VzdGlvbnMiLCJiaW5kIiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicHJvdmlkZURlZmluaXRpb25zIiwicHJpb3JpdHkiLCJncmFtbWFyU2NvcGVzIiwiZ2V0RGVmaW5pdGlvbiIsImdldERlZmluaXRpb25CeUlkIiwiZWRpdG9yIiwicG9pbnQiLCJmaWxlbmFtZSIsImlkIiwicHJvdmlkZU91dGxpbmVzIiwiZ2V0T3V0bGluZSIsInByb3ZpZGVMaW50ZXIiLCJzY29wZSIsImxpbnRPbkZseSIsImxpbnQiLCJnZXRMaW50aW5nIiwicHJvdmlkZURpYWdub3N0aWNzIiwicHJvdmlkZUZpbmRSZWZlcmVuY2VzIiwiaXNFZGl0b3JTdXBwb3J0ZWQiLCJpbmNsdWRlcyIsImdldEdyYW1tYXIiLCJzY29wZU5hbWUiLCJnZXRSZWZlcmVuY2VzIiwicHJvdmlkZUh5cGVyY2xpY2siLCJwcm92aWRlck5hbWUiLCJnZXRTdWdnZXN0aW9uIiwiZ2V0SHlwZXJjbGlja1N1Z2dlc3Rpb24iXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUE7O0lBQVlBLEU7O0FBQ1o7O0lBQVlDLEU7O0FBQ1o7O0lBQVlDLEc7O0FBRVo7Ozs7QUFDQTs7OztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOzs7Ozs7OztJQUVxQkMsa0IsR0FBTixNQUFNQSxrQkFBTixDQUF5QjtBQUFBO0FBQUEsU0FDdENDLFdBRHNDLEdBQ3hCLCtCQUR3QjtBQUFBOztBQWdCdENDLHFCQUFrQztBQUFFLFVBQU0sbUVBQU47QUFBMkU7QUFDL0dDLG9CQUEwQjtBQUFFLFVBQU0sa0VBQU47QUFBMEU7QUFDdEdD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RSxrQiIsImZpbGUiOiJhdXRvLWxhbmd1YWdlY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCAqIGFzIGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0ICogYXMgcnBjIGZyb20gJ3ZzY29kZS1qc29ucnBjJztcclxuXHJcbmltcG9ydCBDb25zb2xlTG9nZ2VyIGZyb20gJy4vbG9nZ2Vycy9jb25zb2xlLWxvZ2dlcic7XHJcbmltcG9ydCBOdWxsTG9nZ2VyIGZyb20gJy4vbG9nZ2Vycy9udWxsLWxvZ2dlcic7XHJcblxyXG5pbXBvcnQgQXV0b2NvbXBsZXRlQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2F1dG9jb21wbGV0ZS1hZGFwdGVyJztcclxuaW1wb3J0IERvY3VtZW50U3luY0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kb2N1bWVudC1zeW5jLWFkYXB0ZXInO1xyXG5pbXBvcnQgRm9ybWF0Q29kZUFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9mb3JtYXQtY29kZS1hZGFwdGVyJztcclxuaW1wb3J0IExpbnRlckFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9saW50ZXItYWRhcHRlcic7XHJcbmltcG9ydCBOb3RpZmljYXRpb25zQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlcic7XHJcbmltcG9ydCBOdWNsaWRlRGVmaW5pdGlvbkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9udWNsaWRlLWRlZmluaXRpb24tYWRhcHRlcic7XHJcbmltcG9ydCBOdWNsaWRlRmluZFJlZmVyZW5jZXNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbnVjbGlkZS1maW5kLXJlZmVyZW5jZXMtYWRhcHRlcic7XHJcbmltcG9ydCBOdWNsaWRlSHlwZXJjbGlja0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9udWNsaWRlLWh5cGVyY2xpY2stYWRhcHRlcic7XHJcbmltcG9ydCBOdWNsaWRlT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbnVjbGlkZS1vdXRsaW5lLXZpZXctYWRhcHRlcic7XHJcblxyXG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2F0b20nO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b0xhbmd1YWdlQ2xpZW50IHtcclxuICBfZGlzcG9zYWJsZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XHJcbiAgX3Byb2Nlc3M6ID9jaGlsZF9wcm9jZXNzJENoaWxkUHJvY2VzcztcclxuICBfbGM6IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbjtcclxuXHJcbiAgYXV0b0NvbXBsZXRlOiA/QXV0b2NvbXBsZXRlQWRhcHRlcjtcclxuICBsaW50ZXI6ID9MaW50ZXJBZGFwdGVyO1xyXG5cclxuICBkZWZpbml0aW9uczogP051Y2xpZGVEZWZpbml0aW9uQWRhcHRlcjtcclxuICBmaW5kUmVmZXJlbmNlczogP051Y2xpZGVGaW5kUmVmZXJlbmNlc0FkYXB0ZXI7XHJcbiAgaHlwZXJjbGljazogP051Y2xpZGVIeXBlcmNsaWNrQWRhcHRlcjtcclxuICBvdXRsaW5lVmlldzogP051Y2xpZGVPdXRsaW5lVmlld0FkYXB0ZXI7XHJcblxyXG4gIGxvZ2dlcjogQ29uc29sZUxvZ2dlciB8IE51bGxMb2dnZXI7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG5cclxuICBnZXRHcmFtbWFyU2NvcGVzKCk6IEFycmF5PHN0cmluZz4geyB0aHJvdyBcIk11c3QgaW1wbGVtZW50IGdldEdyYW1tYXJTY29wZXMgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50XCIgfTtcclxuICBnZXRMYW5ndWFnZU5hbWUoKTogc3RyaW5nIHsgdGhyb3cgXCJNdXN0IGltcGxlbWVudCBnZXRMYW5ndWFnZU5hbWUgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50XCIgfTtcclxuICBnZXRTZXJ2ZXJOYW1lKCk6IHN0cmluZyB7IHRocm93IFwiTXVzdCBpbXBsZW1lbnQgZ2V0U2VydmVyTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnRcIiB9O1xyXG5cclxuICBhY3RpdmF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMubmFtZSA9IGAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9ICgke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSlgO1xyXG4gICAgdGhpcy5sb2dnZXIgPSBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuZGVidWdMU1AnKSA/IG5ldyBDb25zb2xlTG9nZ2VyKHRoaXMubmFtZSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gICAgdGhpcy5zdGFydFNlcnZlcigpO1xyXG4gIH1cclxuXHJcbiAgZGVhY3RpdmF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG5cclxuICAgIGlmICh0aGlzLl9sYykge1xyXG4gICAgICB0aGlzLl9sYy5zaHV0ZG93bigpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl9wcm9jZXNzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fcHJvY2Vzcy5raWxsKCk7XHJcbiAgICAgIHRoaXMuX3Byb2Nlc3MgPSBudWxsO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHN0YXJ0U2VydmVyKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKHRoaXMuX3Byb2Nlc3MgIT0gbnVsbCkgcmV0dXJuO1xyXG5cclxuICAgIHRoaXMuX3Byb2Nlc3MgPSBhd2FpdCB0aGlzLnN0YXJ0U2VydmVyUHJvY2VzcygpO1xyXG5cclxuICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBycGMuY3JlYXRlTWVzc2FnZUNvbm5lY3Rpb24oXHJcbiAgICAgIG5ldyBycGMuU3RyZWFtTWVzc2FnZVJlYWRlcih0aGlzLl9wcm9jZXNzLnN0ZG91dCksXHJcbiAgICAgIG5ldyBycGMuU3RyZWFtTWVzc2FnZVdyaXRlcih0aGlzLl9wcm9jZXNzLnN0ZGluKSxcclxuICAgICAgeyBlcnJvcjogKG06IE9iamVjdCkgPT4geyB0aGlzLmxvZ2dlci5lcnJvcihtKTsgfSB9KTtcclxuXHJcbiAgICB0aGlzLl9sYyA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY29ubmVjdGlvbiwgdGhpcy5sb2dnZXIpO1xyXG4gICAgdGhpcy5fbGMub25Mb2dNZXNzYWdlKG0gPT4gdGhpcy5sb2dnZXIubG9nKFsnTG9nJywgbV0pKTtcclxuXHJcbiAgICBjb25zdCBpbml0aWFsaXplUmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9sYy5pbml0aWFsaXplKHRoaXMuZ2V0SW5pdGlhbGl6ZVBhcmFtcygpKTtcclxuICAgIHRoaXMuYWRhcHRDYXBhYmlsaXRpZXMoaW5pdGlhbGl6ZVJlc3BvbnNlLmNhcGFiaWxpdGllcyk7XHJcbiAgICB0aGlzLnBvc3RJbml0aWFsaXphdGlvbihpbml0aWFsaXplUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgc3RhcnRTZXJ2ZXJQcm9jZXNzKCk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHtcclxuICAgIHRocm93IFwiTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgdGhlIGxhbmd1YWdlIHNlcnZlciBwcm9jZXNzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudFwiO1xyXG4gIH1cclxuXHJcbiAgZ2V0UHJvamVjdFJvb3QoKTogP3N0cmluZyB7XHJcbiAgICBjb25zdCByb290RGlyczogQXJyYXk8YW55PiA9IGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpO1xyXG4gICAgcmV0dXJuIHJvb3REaXJzLmxlbmd0aCA+IDAgPyByb290RGlyc1swXS5wYXRoIDogbnVsbFxyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbGl6ZVBhcmFtcygpOiBscy5Jbml0aWFsaXplUGFyYW1zIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHByb2Nlc3NJZDogcHJvY2Vzcy5waWQsXHJcbiAgICAgIGNhcGFiaWxpdGllczogeyB9LFxyXG4gICAgICByb290UGF0aDogdGhpcy5nZXRQcm9qZWN0Um9vdCgpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYWRhcHRDYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzOiBscy5TZXJ2ZXJDYXBhYmlsaXRpZXMpOiB2b2lkIHtcclxuICAgIHRoaXMubGludGVyID0gbmV3IExpbnRlckFkYXB0ZXIodGhpcy5fbGMpO1xyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5jb21wbGV0aW9uUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5hdXRvQ29tcGxldGUgPSBuZXcgQXV0b2NvbXBsZXRlQWRhcHRlcih0aGlzLl9sYyk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2FwYWJpbGl0aWVzLmRlZmluaXRpb25Qcm92aWRlcikge1xyXG4gICAgICB0aGlzLmRlZmluaXRpb25zID0gbmV3IE51Y2xpZGVEZWZpbml0aW9uQWRhcHRlcih0aGlzLl9sYyk7XHJcbiAgICAgIHRoaXMuaHlwZXJjbGljayA9IG5ldyBOdWNsaWRlSHlwZXJjbGlja0FkYXB0ZXIodGhpcy5fbGMpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNhcGFiaWxpdGllcy5kb2N1bWVudFN5bWJvbFByb3ZpZGVyKSB7XHJcbiAgICAgIHRoaXMub3V0bGluZVZpZXcgPSBuZXcgTnVjbGlkZU91dGxpbmVWaWV3QWRhcHRlcih0aGlzLl9sYywgdGhpcy5uYW1lKTtcclxuICAgIH1cclxuICAgIGlmIChjYXBhYmlsaXRpZXMucmVmZXJlbmNlc1Byb3ZpZGVyKSB7XHJcbiAgICAgIHRoaXMuZmluZFJlZmVyZW5jZXMgPSBuZXcgTnVjbGlkZUZpbmRSZWZlcmVuY2VzQWRhcHRlcih0aGlzLl9sYyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmV3IE5vdGlmaWNhdGlvbnNBZGFwdGVyKHRoaXMuX2xjLCB0aGlzLm5hbWUpO1xyXG5cclxuICAgIGlmIChjYXBhYmlsaXRpZXMudGV4dERvY3VtZW50U3luYykge1xyXG4gICAgICB0aGlzLl9kaXNwb3NhYmxlLmFkZChuZXcgRG9jdW1lbnRTeW5jQWRhcHRlcih0aGlzLl9sYywgY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMpKTtcclxuICAgIH1cclxuICAgIGlmIChjYXBhYmlsaXRpZXMuZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQcm92aWRlciB8fCBjYXBhYmlsaXRpZXMuZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIpIHtcclxuICAgICAgdGhpcy5fZGlzcG9zYWJsZS5hZGQobmV3IEZvcm1hdENvZGVBZGFwdGVyKHRoaXMuX2xjLCBjYXBhYmlsaXRpZXMuZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQcm92aWRlciA9PT0gdHJ1ZSwgY2FwYWJpbGl0aWVzLmRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyID09PSB0cnVlLCB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcG9zdEluaXRpYWxpemF0aW9uKEluaXRpYWxpemF0aW9uUmVzdWx0OiBscy5Jbml0aWFsaXplUmVzdWx0KTogdm9pZCB7XHJcbiAgfVxyXG5cclxuICAvLyBBdG9tIEF1dG9jb21wbGV0ZSsgdmlhIExTIGNvbXBsZXRpb25cclxuXHJcbiAgcHJvdmlkZUF1dG9jb21wbGV0ZSgpOiBhdG9tJEF1dG9jb21wbGV0ZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNlbGVjdG9yOiAnLnNvdXJjZScsXHJcbiAgICAgIGV4Y2x1ZGVMb3dlclByaW9yaXR5OiBmYWxzZSxcclxuICAgICAgZ2V0U3VnZ2VzdGlvbnM6IHRoaXMuZ2V0U3VnZ2VzdGlvbnMuYmluZCh0aGlzKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldFN1Z2dlc3Rpb25zKHJlcXVlc3Q6IGFueSk6IFByb21pc2U8QXJyYXk8YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uPj4ge1xyXG4gICAgcmV0dXJuIHRoaXMuYXV0b0NvbXBsZXRlICE9IG51bGwgPyB0aGlzLmF1dG9Db21wbGV0ZS5nZXRTdWdnZXN0aW9ucyhyZXF1ZXN0KSA6IFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgfVxyXG5cclxuICAvLyBOdWNsaWRlIERlZmluaXRpb25zIHZpYSBMUyBkb2N1bWVudEhpZ2hsaWdodCBhbmQgZ290b0RlZmluaXRpb25cclxuXHJcbiAgcHJvdmlkZURlZmluaXRpb25zKCk6IG51Y2xpZGUkRGVmaW5pdGlvblByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgcHJpb3JpdHk6IDIwLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgZ2V0RGVmaW5pdGlvbjogdGhpcy5nZXREZWZpbml0aW9uLmJpbmQodGhpcyksXHJcbiAgICAgIGdldERlZmluaXRpb25CeUlkOiB0aGlzLmdldERlZmluaXRpb25CeUlkLmJpbmQodGhpcylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldERlZmluaXRpb24oZWRpdG9yOiBUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P251Y2xpZGUkRGVmaW5pdGlvblF1ZXJ5UmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9ucyAhPSBudWxsID8gdGhpcy5kZWZpbml0aW9ucy5nZXREZWZpbml0aW9uKGVkaXRvciwgcG9pbnQpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGVmaW5pdGlvbkJ5SWQoZmlsZW5hbWU6IE51Y2xpZGVVcmksIGlkOiBzdHJpbmcpOiBQcm9taXNlPD9udWNsaWRlJERlZmluaXRpb24+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7IC8vIFRPRE86IElzIHRoaXMgbmVlZGVkP1xyXG4gIH1cclxuXHJcbiAgLy8gTnVjbGlkZSBPdXRsaW5lIFZpZXcgdmlhIExTIGRvY3VtZW50U3ltYm9sXHJcblxyXG4gIHByb3ZpZGVPdXRsaW5lcygpOiBudWNsaWRlJE91dGxpbmVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZ2V0T3V0bGluZTogdGhpcy5nZXRPdXRsaW5lLmJpbmQodGhpcylcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRPdXRsaW5lKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogUHJvbWlzZTw/bnVjbGlkZSRPdXRsaW5lPiB7XHJcbiAgICByZXR1cm4gdGhpcy5vdXRsaW5lVmlldyAhPSBudWxsID8gdGhpcy5vdXRsaW5lVmlldy5nZXRPdXRsaW5lKGVkaXRvcikgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgfVxyXG5cclxuICAvLyBMaW50ZXIgQVBJIHZpYSBMUyBwdWJsaXNoRGlhZ25vc3RpY3NcclxuXHJcbiAgcHJvdmlkZUxpbnRlcigpOiBsaW50ZXIkU3RhbmRhcmRMaW50ZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgc2NvcGU6ICdwcm9qZWN0JyxcclxuICAgICAgbGludE9uRmx5OiB0cnVlLFxyXG4gICAgICBsaW50OiB0aGlzLmdldExpbnRpbmcuYmluZCh0aGlzKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldExpbnRpbmcoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpOiA/QXJyYXk8bGludGVyJE1lc3NhZ2U+IHwgUHJvbWlzZTw/QXJyYXk8bGludGVyJE1lc3NhZ2U+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5saW50ZXIgIT0gbnVsbCA/IHRoaXMubGludGVyLnByb3ZpZGVEaWFnbm9zdGljcygpIDogUHJvbWlzZS5yZXNvbHZlKFtdKTtcclxuICB9XHJcblxyXG4gIC8vIE51Y2xpZGUgRmluZCBSZWZlcmVuY2VzIHZpYSBMUyBmaW5kUmVmZXJlbmNlc1xyXG5cclxuICBwcm92aWRlRmluZFJlZmVyZW5jZXMoKTogbnVjbGlkZSRGaW5kUmVmZXJlbmNlc1Byb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlzRWRpdG9yU3VwcG9ydGVkOiAoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpID0+IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLmluY2x1ZGVzKGVkaXRvci5nZXRHcmFtbWFyKCkuc2NvcGVOYW1lKSxcclxuICAgICAgZmluZFJlZmVyZW5jZXM6IHRoaXMuZ2V0UmVmZXJlbmNlcy5iaW5kKHRoaXMpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRSZWZlcmVuY2VzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P251Y2xpZGUkRmluZFJlZmVyZW5jZXNSZXR1cm4+IHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRSZWZlcmVuY2VzICE9IG51bGwgPyB0aGlzLmZpbmRSZWZlcmVuY2VzLmdldFJlZmVyZW5jZXMoZWRpdG9yLCBwb2ludCwgdGhpcy5nZXRQcm9qZWN0Um9vdCgpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICB9XHJcblxyXG4gIC8vIE51Y2xpZGUgSHlwZXJsaWNrIHZpYSBMUyBnb3RvRGVmaW5pdGlvbiBhbmQgZG9jdW1lbnRIaWdobGlnaHRcclxuXHJcbiAgcHJvdmlkZUh5cGVyY2xpY2soKTogbnVjbGlkZSRIeXBlcmNsaWNrUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJpb3JpdHk6IDIwLFxyXG4gICAgICBwcm92aWRlck5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgZ2V0U3VnZ2VzdGlvbjogdGhpcy5nZXRIeXBlcmNsaWNrU3VnZ2VzdGlvbi5iaW5kKHRoaXMpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0SHlwZXJjbGlja1N1Z2dlc3Rpb24oZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/bnVjbGlkZSRIeXBlcmNsaWNrU3VnZ2VzdGlvbj4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHlwZXJjbGljayAhPSBudWxsID8gdGhpcy5oeXBlcmNsaWNrLmdldFN1Z2dlc3Rpb24oZWRpdG9yLCBwb2ludCkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==